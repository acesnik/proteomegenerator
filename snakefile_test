# variables
WD = "/home/kwokn/test"
workdir: WD
REF = '/ifs/e63data/poirierj/indexes/GRCh38/STAR'
DICT = '/ifs/e63data/poirierj/indexes/GRCh38/BWAIndex/GRCh38.genome.dict'
STAR = '/ifs/e63data/poirierj/bin/STAR/bin/Linux_x86_64_static/STAR'

K0562 = 'FCH9EFLADXX-HUMbghEAACRAAPEI-225'.split()

SAMPLES = K0562

MODELS = 'merged reference'.split()
ADBS = expand('adb{n}',n=range(1,8))
DBS = ADBS + 'merged reference uniprot Ecoli loki'.split()

snakemake.utils.makedirs('/scratch/kwokn')
snakemake.utils.makedirs('out/benchmarks')
snakemake.utils.makedirs('out/all-merge')

#benchmarking figures
# onsuccess:
#     print("Workflow finished, no error.")
#     shell("{RSCRIPT} {SCRIPTS}/stats.R {WD}/out/benchmarks")
# onerror:
#     print("Workflow finished with errors.")
#     shell("{RSCRIPT} {SCRIPTS}/stats.R {WD}/out/benchmarks")

rule all:
    input: 
        #expand("out/all-merge/{db}.db.fasta.pepdigest",db=DBS),
        expand("out/all-merge/{model}/proteome.bed",model=MODELS),
        expand("out/all-merge/{model}/proteome.fasta",model=MODELS)
        #, "out/preseq.pdf", "out/all-merge/gffcmp.stats"
        
#rule STAR:
#    input: l1r1="/ifs/e63data/kentsislab/K0562_RNAseq/{sample}_L1_1.fq.gz", l2r1="/ifs/e63data/kentsislab/K0562_RNAseq/{sample}_L2_1.fq.gz", l1r2="/ifs/e63data/kentsislab/K0562_RNAseq/{sample}_L1_2.fq.gz", l2r2="/ifs/e63data/kentsislab/K0562_RNAseq/{sample}_L2_2.fq.gz"
#    output: "out/{sample}.Aligned.sortedByCoord.out.bam", "out/{sample}.Chimeric.out.junction"
#    benchmark: "out/benchmarks/{sample}.align.json"
#    params: pe="2", mem="h_vmem=20G,virtual_free=18G", err="~/error/error.snake", name="align"
#    shell: "{STAR} \
#        --genomeDir {REF} \
#        --readFilesIn {input.l1r1},{input.l2r1} {input.l1r2},{input.l2r2} \
#        --outFileNamePrefix out/{wildcards.sample}. \
#        --outSAMattributes NH HI \
#        --outSAMattrRGline ID:{wildcards.sample} LB:1 PL:illumina PU:1 SM:{wildcards.sample} \
#        --runThreadN {params.pe} \
#        --outSAMtype BAM SortedByCoordinate \
#        --clip3pAdapterSeq AGATCGGAAGAG \
#        --readFilesCommand zcat \
#        --outSAMmapqUnique 60 \
#        --twopassMode Basic \
#        --chimOutType WithinBAM \
#        --outSAMstrandField intronMotif \
#        --outFilterIntronMotifs RemoveNoncanonical \
#        --outReadsUnmapped None \
#       --chimSegmentMin 15 \
#        --chimJunctionOverhangMin 15 \
#        --alignMatesGapMax 200000 \
#        --alignIntronMax 200000"
        
include: "pgm-new"

#snakemake --snakefile Snakefile-K056 --cluster "qsub -pe smp {params.pe} -l {params.mem} -e {params.err}" --jn {rulename}.{jobid}.sj -j 100 -k --ri --latency-wait 30 -n
# --rulegraph | dot -Tpdf > dag.pdf